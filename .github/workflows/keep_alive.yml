name: Keep GentleQuest Warm

on:
  schedule:
    # Every 10 minutes to avoid Render free-tier idle sleep (15 min)
    # Changed from */13 to */10 for safer margin
    - cron: "*/10 * * * *"
  workflow_dispatch: {}

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Add small jitter to distribute load
        run: |
          JITTER=$(( RANDOM % 30 ))  # 0-29 seconds (reduced from 60)
          echo "Sleeping for $JITTER seconds to add jitter..."
          sleep $JITTER
      - name: Ping /api/ping (HEAD) with fallback to /api/health (GET)
        run: |
          set -euxo pipefail
          URL="https://gentlequest.onrender.com/api/ping"
          # Try a HEAD request first (lightweight), fallback to GET /api/health
          (curl -fsSI --max-time 5 -H "User-Agent: gentlequest-keepalive/1.0" "$URL" || \
           curl -fsS  --max-time 5 -H "User-Agent: gentlequest-keepalive/1.0" "https://gentlequest.onrender.com/api/health") || true
