# 🚀 Deployment Guide: AI Mental Health Assistant on Render

## ✅ **Pre-Deployment Checklist**

### **1. Repository Status**
- ✅ Clean git repository
- ✅ All critical fixes applied
- ✅ Risk score conversion issue resolved
- ✅ Database models working
- ✅ API endpoints functional

### **2. Required Files**
- ✅ `app.py` - Main Flask application
- ✅ `requirements.txt` - Python dependencies
- ✅ `models.py` - Database models
- ✅ `crisis_detection.py` - Crisis detection logic
- ✅ `providers/` - AI provider modules
- ✅ `Dockerfile` - Container configuration
- ✅ `render.yaml` - Render deployment config
- ✅ `docker-compose.yml` - Local testing

## 🎯 **Deployment Steps**

### **Step 1: Push to GitHub**
```bash
# Create deployment branch
git checkout -b deploy-render

# Add deployment files
git add Dockerfile render.yaml docker-compose.yml DEPLOYMENT_GUIDE.md

# Commit deployment files
git commit -m "Add deployment configuration for Render"

# Push to GitHub
git push origin deploy-render
```

### **Step 2: Render Dashboard Setup**

1. **Go to Render Dashboard**: https://dashboard.render.com
2. **Create New Service**: Click "New +" → "Web Service"
3. **Connect Repository**: Link your GitHub repository
4. **Select Branch**: Choose `deploy-render` branch
5. **Configure Service**:
   - **Name**: `ai-mental-health-backend`
   - **Environment**: `Python`
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `python app.py`
   - **Plan**: Free

### **Step 3: Environment Variables**

Set these environment variables in Render dashboard:

**Required Variables:**
- `DATABASE_URL` - Will be auto-generated by Render
- `SECRET_KEY` - Will be auto-generated by Render
- `PORT` - Set to `10000`

**AI Provider Keys (Set manually):**
- `GEMINI_API_KEY` - Your Gemini API key
- `OPENAI_API_KEY` - Your OpenAI API key (optional)
- `PPLX_API_KEY` - Your Perplexity API key (optional)
- `AI_PROVIDER` - Set to `gemini` (default)

### **Step 4: Database Setup**

1. **Create PostgreSQL Database**:
   - In Render dashboard, go to "Databases"
   - Create new PostgreSQL database
   - Name: `ai-mental-health-db`
   - Plan: Free

2. **Link Database**:
   - In your web service settings
   - Add `DATABASE_URL` environment variable
   - Link to the created database

### **Step 5: Deploy**

1. **Manual Deploy**: Click "Deploy" in Render dashboard
2. **Monitor Build**: Watch the build logs for any issues
3. **Verify Health**: Check `/api/health` endpoint

## 🔧 **Post-Deployment Verification**

### **1. Health Check**
```bash
curl https://your-app-name.onrender.com/api/health
```

**Expected Response:**
```json
{
  "status": "healthy",
  "timestamp": "2025-07-29T...",
  "environment": "production",
  "provider": "gemini",
  "port": "10000",
  "cors_enabled": true
}
```

### **2. Chat API Test**
```bash
curl -X POST https://your-app-name.onrender.com/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message":"Hello, I am feeling sad today"}'
```

### **3. Assessment API Test**
```bash
curl -X POST https://your-app-name.onrender.com/api/self_assessment \
  -H "Content-Type: application/json" \
  -H "X-Session-ID: test-session-123" \
  -d '{"mood":"happy","energy":"high","sleep":"good","stress":"low"}'
```

## 🐛 **Troubleshooting**

### **Common Issues:**

1. **Build Failures**:
   - Check `requirements.txt` for missing dependencies
   - Verify Python version compatibility
   - Check build logs for specific errors

2. **Database Connection Issues**:
   - Verify `DATABASE_URL` is correctly set
   - Check database is running and accessible
   - Ensure database tables are created

3. **API Key Issues**:
   - Verify all API keys are correctly set
   - Check API provider is responding
   - Test with different AI providers

4. **CORS Issues**:
   - Verify CORS origins are correctly configured
   - Check frontend is making requests to correct URL
   - Test with different browsers

### **Debug Commands:**
```bash
# Check application logs
# In Render dashboard → Logs tab

# Test database connection
curl https://your-app-name.onrender.com/api/health

# Test API functionality
curl https://your-app-name.onrender.com/api/deploy-test
```

## 📱 **Frontend Integration**

### **Update Frontend Configuration:**

1. **Update API Base URL**:
   ```dart
   // In ai_buddy_web/lib/config/api_config.dart
   static const String baseUrl = 'https://your-app-name.onrender.com/api';
   ```

2. **Rebuild Flutter Web App**:
   ```bash
   cd ai_buddy_web
   flutter build web
   ```

3. **Deploy Frontend**:
   - Use Netlify, Vercel, or GitHub Pages
   - Point to `ai_buddy_web/build/web` directory

## 🎉 **Success Indicators**

✅ **Backend Health**: `/api/health` returns 200  
✅ **Chat API**: Messages processed successfully  
✅ **Assessment API**: Data received and stored  
✅ **Database**: Tables created and accessible  
✅ **CORS**: Frontend can communicate with backend  
✅ **AI Responses**: Gemini/OpenAI responding correctly  

## 📊 **Monitoring**

### **Render Dashboard Metrics:**
- **CPU Usage**: Should be low for free tier
- **Memory Usage**: Monitor for memory leaks
- **Response Time**: Should be under 5 seconds
- **Error Rate**: Should be minimal

### **Application Metrics:**
- **Active Sessions**: Track user engagement
- **Crisis Events**: Monitor crisis detection
- **API Usage**: Track endpoint usage

## 🔄 **Updates and Maintenance**

### **Deploying Updates:**
1. Make changes to code
2. Commit and push to `deploy-render` branch
3. Render will auto-deploy
4. Monitor deployment logs
5. Test endpoints after deployment

### **Database Migrations:**
- Render handles PostgreSQL updates automatically
- Monitor for any schema changes needed
- Backup data before major changes

---

## 🎯 **Quick Deploy Commands**

```bash
# 1. Prepare deployment
git checkout -b deploy-render
git add .
git commit -m "Prepare for Render deployment"
git push origin deploy-render

# 2. Deploy on Render (via dashboard)
# - Connect repository
# - Set environment variables
# - Deploy service

# 3. Verify deployment
curl https://your-app-name.onrender.com/api/health
```

**Status**: ✅ **READY FOR DEPLOYMENT** 🚀 